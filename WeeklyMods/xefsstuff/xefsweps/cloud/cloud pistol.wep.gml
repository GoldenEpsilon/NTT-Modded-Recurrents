#define init
global.sprCloudPistol_0 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAMAAAAR8Wy4AAAAG1BMVEUAAAAyJxoAAAAyJxpUQix/ZEOfw92vj2rg7vjcXJTlAAAAAnRSTlMAAHaTzTgAAABISURBVAjXrY3BDsAwCEJbxNr//+ISNrMddtw7EAWJY3wD89rXFgtPXKaPQGSIZNmAxgxSSjhnVIW1D+A62hBMzImr0X9u+YUDy7sBZerGjqgAAAAASUVORK5CYII=", -1, 4);
global.sprCloudPistol_1 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAMAAAAR8Wy4AAAAG1BMVEUAAAAyJxoAAAAyJxpUQix/ZEOfw92vj2rg7vjcXJTlAAAAAnRSTlMAAHaTzTgAAABISURBVHjarY07DsAwDEIb8Cf3P3FiKitZuvUNSAgQzwcQl4+5CZw4RZdg8NgFt4Q86U6WGpQbMyntAjQv7UdzjIFanJ9X/mEB1KQBcwOP1EQAAAAASUVORK5CYII=", -1, 4);
global.sprCloudPistol_2 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAMAAAAR8Wy4AAAAHlBMVEUAAAAyJxoAAAAyJxpUQixyn79/ZEOfw92vj2rg7vgQmqXKAAAAAnRSTlMAAHaTzTgAAABKSURBVHjarY3BDsAgDEInrZT9/w+vdnHu4s13ICFAuDag+Pm4k8CKVcwSHIws0IXyZmSP6KSjcjfJEn0F1HzofHSiNYzF+nnlDA/uHwGehVvVMgAAAABJRU5ErkJggg==", -1, 4);
global.sprCloudPistol_3 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAMAAAAR8Wy4AAAAIVBMVEUAAAAyJxoAAAAyJxpUQixyn79/ZEOfw92vj2rg7vj///+gbd5wAAAAAnRSTlMAAHaTzTgAAABKSURBVHjarY3BDsAgDEInrdD9/w+vdnHu4s13ICFAuDag+HndibDiKGYJDioL9EB5M1IJ6ajcLaJLPb4Caj50PjrRGsZi/bxyhgf2SwGuYFQbPgAAAABJRU5ErkJggg==", -1, 4);
global.sprCloudPistol_4 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAMAAAAR8Wy4AAAAHlBMVEUAAAAAAAAyJxpUQixyn79/ZEOfw92vj2rg7vj///+ifK05AAAAAXRSTlMAQObYZgAAAEhJREFUeNqtzTEOwDAIA8AaYrv/f3ERUZIu3XoDEmDE9QHt1esuwlm7rRASVAWYRvcRnAMmep9hq3gHYA9prEFJovTF/jPLPx7NNQFo5NGbGAAAAABJRU5ErkJggg==", -1, 4);
global.sprCloudPistol_5 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAMAAAAR8Wy4AAAAG1BMVEUAAAAAAAAyJxpUQixyn79/ZEOfw92vj2rg7vi/CrruAAAAAXRSTlMAQObYZgAAAEdJREFUeAGty0EChCAMQ1HS0mbuf+KJQdSNO9+O3zBewB7v/knjPtP2CIlqDSrpgIhaoRK+Z5BH4DWAguwgWbN7+seC0/jGH9dEAYId3vnoAAAAAElFTkSuQmCC", -1, 4);
global.sprCloudPistol_6 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAMAAAAR8Wy4AAAAG1BMVEUAAAAAAAAyJxpUQixyn79/ZEOfw92vj2rg7vi/CrruAAAAAXRSTlMAQObYZgAAAEtJREFUeNqdjjEOwDAMAoMdQ///4iJXSbp06W3AWfL4AM0r8zLEmdUsCYmihUqhc0Q9RSV6z5BotAVINnZhsmh8cd6Y5MTKyxs/uQHeFAGa4Ek/ZgAAAABJRU5ErkJggg==", -1, 4);
global.sprCloudPistol_7 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAMAAAAR8Wy4AAAAG1BMVEUAAAAAAAAyJxpUQixyn79/ZEOfw92vj2rg7vi/CrruAAAAAXRSTlMAQObYZgAAAE1JREFUeNqNjlEOgDAIQ1cYxfuf2IpuUxMT3x+vDWn7AMXt5iaIFWcxSnAEVQjPEjCLU4SjcrfMQ+QsQEIMIfz6gTWD4jGkkx3vqe0fO+W7AbgDErKjAAAAAElFTkSuQmCC", -1, 4);
global.sprCloudPistol_8 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAABAAAAAOCAMAAAAR8Wy4AAAAG1BMVEUAAAAAAAAyJxpUQixyn79/ZEOfw92vj2rg7vi/CrruAAAAAXRSTlMAQObYZgAAAE9JREFUeNp1jlEOgDAIQ9cxivc/sZU5R4y+P14b0vYDknLzEMSOI1klGJwquEUK9O5TuCFz6xGXiKcACbGEsPsH9gyKOmSKunSQA+/t7ZMT6fIB0mUOoIMAAAAASUVORK5CYII=", -1, 4);

global.sprCPBullet = sprite_add_base64("iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAMAAACROYkbAAAAFVBMVEUAAAByn7+fw93///9yn7+fw93///89T4TsAAAABHRSTlMAAAAAs5NmmgAAAIJJREFUeNrdk0sOgCAMRBkYvP+RnfJxFqxId75oTMf2hSiUgH3AUQAU3ZFgoS7XAUHiG3/EfK9Y5cYTIXBti273y7B0NhQsKobBw0oAPaPfhkOAKlpwCJRVlEhNJ3kK2mQLNpHXtQAvAbeC3e0B3gjwA0H6I6Z/Y3Yjpbdy/jClj/MLKLcNp/ErVaUAAAAASUVORK5CYII=",4,8,8);

global.CPBulletGlower = noone;

#define weapon_name
return "CLOUD PISTOL";

#define weapon_sprt
with(self) if (instance_exists(Player)) && ("wep" in self) && ((wep = "cloud pistol") || (bwep = "cloud pistol")) && ("CPAmmo" in self) && (CPAmmo < 7.5){
	if CPAmmo > 6.5 return global.sprCloudPistol_7;
	else if CPAmmo > 5.5 return global.sprCloudPistol_6;
	else if CPAmmo > 4.5 return global.sprCloudPistol_5;
	else if CPAmmo > 3.5 return global.sprCloudPistol_4;
	else if CPAmmo > 2.5 return global.sprCloudPistol_3;
	else if CPAmmo > 1.5 return global.sprCloudPistol_2;
	else if CPAmmo > 0.5 return global.sprCloudPistol_1;
	else return global.sprCloudPistol_0;
}
else return global.sprCloudPistol_8;

#define weapon_type
return 0;

#define weapon_melee
return false;

#define weapon_auto
return true;

#define weapon_load
return 7.5;

#define weapon_cost
return 0;

#define weapon_swap
return sndSwapMachinegun;

#define weapon_area
if GameCont.hard < 25 {
	return 9;
}
return -1;

#define weapon_text
return "POOFY AMMO";

#define weapon_fire
if CPAmmo > 0 {
	if !instance_exists(global.CPBulletGlower) {
		global.CPBulletGlower = instance_create(0, 0, CustomObject);
		with(global.CPBulletGlower){
			script_bind_draw(CPBulletGlow, 0.1);
		}
	}
	with instance_create(x+lengthdir_x(2, gunangle),y+lengthdir_y(2, gunangle),CustomProjectile){
		motion_add(other.gunangle + random_range(-5,5)*other.accuracy,15 + 2.5*skill_get(13));
		image_angle = direction;

		team = other.team;
		creator = other;

		sprite_index = global.sprCPBullet;
		mask_index = mskBullet1;
		
		damage = 4;
		force = 4;
		
		on_hit = script_ref_create(CPHurt);
		on_wall = script_ref_create(CPWall);
		
		canthurt = noone;
		hurttime = -1;
		
		script_bind_step(CPbullet, 0, id);
	}
	sound_play_gun(sndOasisShoot, 0.25, 0.5);
	motion_add(other.gunangle,-2)
	wkick = 10;

	CPAmmo -= 0.5;
	
}
else with instance_create(x,y,PopupText){
	mytext = "EMPTY";
	time = 15;
}
wkick = 8;

#define step
with(Player) if (wep = "cloud pistol") || (bwep = "cloud pistol") {
	if "CPAmmo" not in self CPAmmo = 8 + 8*skill_get(10);
	
	if (((wep = "cloud pistol") && wkick <= 0) || (wep != "cloud pistol")) && (CPAmmo < 8 + 8*skill_get(10)) {
		CPAmmo += 0.03;
	}
}

#define CPbullet(Me)
with (Me) {
	image_angle = direction;

	if speed > 0 speed -= speed/10;
	
	if (speed > 1) && ((image_index > 1) && (image_index < 2)) image_speed = 0;
	else image_speed = 0.5;
	
	if image_index > 3 instance_destroy();
	
	with(projectile) if instance_exists(self) && instance_exists(other) && (team != other.team) && (distance_to_object(other) < 15) {
		instance_destroy();
		other.speed /= (1.5 - 0.25*skill_get(13));
	}
	
	if (instance_exists(self)) && (hurttime >= 0) hurttime -= 1;
	if (instance_exists(self)) && (hurttime = 0) && (canthurt != noone) canthurt = noone;
	
}
if (!instance_exists(Me)) {
	instance_destroy();
}

#define CPBulletGlow
with(CustomProjectile) if sprite_index = global.sprCPBullet {
	draw_set_blend_mode(bm_add);
	draw_sprite_ext(sprite_index, image_index, x, y, 1.5, 1.5, direction, c_white, 0.1);
	draw_set_blend_mode(bm_normal);
}

#define CPHurt
if canthurt != other {
	projectile_hit(other, damage, force, direction);
	canthurt = other;
	hurttime = 10;
}

#define CPWall
speed = 0;