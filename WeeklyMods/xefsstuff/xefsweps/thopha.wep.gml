#define init
global.sprRail20 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAACQAAAAOCAMAAABw6U76AAAAIVBMVEUAAAAdGyMvLjQAAAAdGyMvLjRITDxRUFh5fmuqr5f////e5QcAAAAAA3RSTlMAAAD6dsTeAAAAg0lEQVR42oWPMRIEIQgE2R0Q+P+Hz1FKA+pqOxC120DpAJBPEPGvwyXTbI4m5zR3I6mZ7mq4TqA0ALTIWJECoNEd+cQuOSJmRE/DuKKLhWYyYLhLRo2I6Q5mFQFY6347BvekhtTKRk7Eq5c/hlwYYcEogu7pEXA2GKMOjBrthUK+qfoHyXMFVVklh9YAAAAASUVORK5CYII=", 7, 4);
global.sprRail21 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAACQAAAAOCAMAAABw6U76AAAAGFBMVEUAAAAAAAAdGyMvLjRITDxRUFh5fmuqr5enVb+yAAAAAXRSTlMAQObYZgAAAH5JREFUeNqFi1ESwyAIBXmgcP8bh4eSNmM72Q9w3EVOAMgrcP/X4UOEWa5D5rY5rYiIOdXQjpFSANBmRQqARlc0E/si3DOip2HM6Il5BAOGq2R04J6uyXJHAGqu2zH4JnvJmtXIHfErgdVq0LeM3MudEfo/GeOMit8XCnln1xdLvAL5ES+CkgAAAABJRU5ErkJggg==", 7, 4);
global.sprRail22 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAACQAAAAOCAMAAABw6U76AAAAGFBMVEUAAAAAAAAdGyMvLjRITDxRUFh5fmuqr5enVb+yAAAAAXRSTlMAQObYZgAAAIFJREFUeAGFy0GOxTAIBFGKtuH+Nx74RPHCGuVtsNRluwH2iYj/Oo5MCbjGutpbqeKZe7s4m+EqgJeMsn6RAyo+0S4auVpERb3v0vETDYW8ZE7gmrKjS0RtL+mJoA/M37X63Z5jlEmxNwKsIOzoiJ+OIma7IngfrHVFx/3DsW9P/QdaNgMBR3og/QAAAABJRU5ErkJggg==", 7, 4);
global.sprRail23 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAACQAAAAOCAMAAABw6U76AAAAGFBMVEUAAAAAAAAdGyMvLjRITDxRUFh5fmuqr5enVb+yAAAAAXRSTlMAQObYZgAAAIFJREFUeAGFkEGuBSEIBGmbgfvf+NsMXxfkZWohJFVstAkA+wQRvzpcMkkAQ+6Zz8Ni5V4XcZ1hSeg+Gq9oAaiTN3o2JNP/idiRvIziigSDq8lUoPAtFQ0itjuQHQGo97111y56WL9q7ET9ASDsogiFoohyMwLOAvcZHebFgn3T9R9oegMJAuj8lQAAAABJRU5ErkJggg==", 7, 4);
global.sprRail24 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAACQAAAAOCAMAAABw6U76AAAAG1BMVEUAAAAAAAAdGyMvLjRITDxRUFh5fmuqr5f///9BecLVAAAAAXRSTlMAQObYZgAAAIFJREFUeAGFy2GOxiAIhGGGQbj/jddRu/qlJn1/2AYe7B0A+wyZVwcYdlXkL1tzgK1x5FWtOfHshFyLyl0M5ADGyUStV3GU2ZH22ghPxKTvqgQEpxR6lcnjhlwIwHjnbYT+1frYemXsH2nUA2FHeG6FMrW7IDzzXsQd2f3CYd8t/QeBKgMYfgcm9gAAAABJRU5ErkJggg==", 7, 4);
global.sprRail25 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAACQAAAAOCAMAAABw6U76AAAAG1BMVEUAAAAAAAAdGyMvLjRITDxRUFh5fmuqr5f///9BecLVAAAAAXRSTlMAQObYZgAAAIJJREFUeAGF0EuOwzAMg2FR1OP+N57QdqYOYiD/Qi3qj5vaOwD2GaoODtD51U0+2fhVh5kceXemE/dQyMmuvRjItdNkomTHo6oL6T2vhAcq+l63gOCUQq+quK3IhQCMO7cR+q7Wh60rY/9o/QEgbAv3VqhKbwekqRKMOCM7Lxz23dJ/feMDFAcuFYAAAAAASUVORK5CYII=", 7, 4);
global.sprRail26 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAACQAAAAOCAMAAABw6U76AAAAG1BMVEUAAAAAAAAdGyMvLjRITDxRUFh5fmuqr5f///9BecLVAAAAAXRSTlMAQObYZgAAAH5JREFUeNqFkEkOwCAMA3HW//+4xIVWKJU6hxDF4wujA2D8gojuAZwvmaqnVkdG6q5EMt1FsYsliWYcGCUBwMqW7CRiSpX7pOSSQuUgswSKXEpqRMzsQXVJADjvrtncyXrGPemMR8L6FuWzwe6WFMGsS9j3iVmXyHdDMP5Z9gV9hQMTvWAgnAAAAABJRU5ErkJggg==", 7, 4);
global.sprRail27 = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAACQAAAAOCAMAAABw6U76AAAAG1BMVEUAAAAAAAAdGyMvLjRITDxRUFh5fmuqr5f///9BecLVAAAAAXRSTlMAQObYZgAAAH5JREFUeNqF0EEShDAIRFEaCNz/xgMETWVY+BexNK830gwAfQaz4fodJ3eRmwGOStaSit3XYsEzTMRud1qIAdSkkf5lFijvV5Q4kAnfuSdIuGWikZmcXchGAOrcW1VmVP2gfZahF/UPgIBOiVAlMqu7ifB8j1QHOs0Fg75r/QOCCAMWVCLtsQAAAABJRU5ErkJggg==", 7, 4);

global.mskthopha = sprite_add_base64("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAMAAAAoyzS7AAAAA1BMVEUAAACnej3aAAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==", 1, 0, 0);

#define weapon_name
return "THOPHA";

#define weapon_sprt
with(self) if (instance_exists(Player)) && ("wep" in self) && (wep = "thopha") && ("wkick" in self) && (wkick > 0){
	if (wkick >= 12) return global.sprRail27;
	else if (wkick >= 11) return global.sprRail26;
	else if (wkick >= 10) return global.sprRail25;
	else if (wkick >= 8) return global.sprRail24;
	else if (wkick >= 6) return global.sprRail23;
	else if (wkick >= 4) return global.sprRail22;
	else return global.sprRail21;
}
else return global.sprRail20;

#define weapon_type
return 1;

#define weapon_auto
return false;

#define weapon_load
return 20;

#define weapon_cost
return 2;

#define weapon_swap
return sndSwapMachinegun;

#define weapon_area
return 33;

#define weapon_text
return "AAAAAAAAAAAAAAAAAAA";

#define weapon_fire
thophalength = 0;
	while ((!collision_line(x, y, x+lengthdir_x(thophalength,gunangle), y+lengthdir_y(thophalength,gunangle), Wall, 0, 1)) && (thophalength < 500)) {
	thophalength += 5;
}

var flamemaker = 0;
while (flamemaker < thophalength) {
	flamemaker += 5;
	instance_create(x+lengthdir_x(flamemaker,gunangle)+random_range(-2,2),y+lengthdir_y(flamemaker,gunangle)+random_range(-2,2),GroundFlame)
}

with instance_create(x+lengthdir_x(2, gunangle),y+lengthdir_y(2, gunangle),CustomProjectile){
	lifetime = 5;
	owner = other;
	team = other.team;
	mask_index = global.mskthopha;
	image_angle = other.gunangle;
	image_xscale = other.thophalength;
	image_yscale = 2;
	length = other.thophalength;
	
	script_bind_step(thophastep, 0, id);
			
	on_hit = script_ref_create(hurt);
	on_wall = script_ref_create(nothing);
}
with instance_create(x+lengthdir_x(2, gunangle),y+lengthdir_y(2, gunangle),CustomProjectile){
	lifetime = 10;
	owner = other;
	team = other.team;
	mask_index = global.mskthopha;
	image_angle = other.gunangle;
	image_xscale = other.thophalength;
	image_yscale = -2;
	length = other.thophalength;
	
	damage = 75;
	
	script_bind_step(thophastep, 0, id);
			
	on_hit = script_ref_create(hurt);
	on_wall = script_ref_create(nothing);
}

instance_create(x+lengthdir_x(thophalength, gunangle),y+lengthdir_y(thophalength, gunangle),Explosion)

fireanglec2 = gunangle+180
speedcountc2 = -15;

sound_play_gun(sndTurretFire, 0.25, -0.5);
sound_play_pitchvol(sndExplosion, 0.5, 0.75);
sound_play_pitchvol(sndExplosion, 0.25, 1.5);

weapon_post(16, 20, 100);

repeat(15){
	with instance_create(x+lengthdir_x(-15, gunangle),y+lengthdir_y(-15, gunangle),Smoke){
		speed = 3;
		direction = other.gunangle + (random(90) - 45)
	}
}

#define step
if (argument0) {
	if (wkick = 3) {
		sound_play_pitchvol(sndCrystalShield, 2, 2);
		sound_play_pitchvol(sndGoldTankHurt, 2.5, 0.75);
		repeat(2) with instance_create(x,y,Bullet2) {
			team = other.team;
			creator = other;
			direction = other.gunangle + 180 + random_range(-30,30);
			speed = 15;
			image_xscale = 0.75;
			image_yscale = 0.75;
			damage *= 0.75;
		}
	}
	if (wkick = 2) {
		wkick = -6;
	}
}

if ("speedcountc2" in self) && (speedcountc2 < 0){
	
	if (speedcountc2 < -5) {
		instance_create(x+random_range(-2,2),y+random_range(-2,2),GroundFlame);
		repeat(3) {
			with instance_create(x,y,Dust) {
				direction = other.fireanglec2 + random_range(-15,15);
				speed = random_range(5,15);
			}
		}
	
		if (collision_line(x, y, x+lengthdir_x(8,fireanglec2), y+lengthdir_y(8,fireanglec2), Wall, 0, 1)) {
				if (speedcountc2 < -12) {
					instance_create(x,y,SmallExplosion);
					projectile_hit(self, 2, 0, 0);
					speedcountc2 = -5;
				}
				else {
					speedcountc2 += 5;
				}
				
				fireanglec2 += 180;
		}
	}
	
	if (speedcountc2 < -10) {
		repeat(2) {
			if (!collision_line(x, y, x+lengthdir_x(12,fireanglec2), y+lengthdir_y(12,fireanglec2), Wall, 0, 1)) {
				x += lengthdir_x(5,fireanglec2);
				y += lengthdir_y(5,fireanglec2);
			}
		}
		
		with collision_circle(x,y,10,enemy,0,1) {
			projectile_hit(id, 40, 50, other.fireanglec2);
		}
	}
	
	direction = fireanglec2;
	speed = (4 - speedcountc2);
	
	if (speedcountc2 < 0) {speedcountc2 += 1;}
}

#define thophastep(Me)
with(Me){
	script_bind_draw(draw_thophabeam, depth-0.1, id);
	
	if (lifetime <= 0) {
		instance_destroy();
	} else {
		lifetime -= 1;
	}
}
if (!instance_exists(Me)) {
	instance_destroy();
}

#define draw_thophabeam(Me)
with (Me) if (instance_exists(owner)){
	draw_set_alpha((lifetime)/10);
	draw_line_width_colour(owner.x, owner.y, x+lengthdir_x(image_xscale,image_angle), y+lengthdir_y(image_xscale,image_angle), (10 - lifetime)*2, c_white, c_white);
	draw_set_alpha(1);
}
instance_destroy();

#define hurt
if (lifetime = 10) {projectile_hit(other, damage, 100, image_angle);};

#define nothing