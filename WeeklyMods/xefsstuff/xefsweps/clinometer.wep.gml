#define init
global.sprClino = sprite_add_weapon("iVBORw0KGgoAAAANSUhEUgAAABcAAAANCAMAAAB1uQVvAAAAM1BMVEUAAAA4pBJMVl2Klp6+/QgAAAAcIiYuNz4yOT44pBI/GRNMVl1fLyZseoSKlp6+/Qj///8K9xvmAAAABXRSTlMAAAAAAMJrBrEAAABySURBVHgBZZBZDsMgFAPpMpjEecn9b9uypKhi/AW2LExqUEkLZEl5MRAVTeP57te3/at8jSMNAb7iMiTIQIQ1dJ6nTUKWFFWuavm4845QxxHhVp1Hf0+UzVvhMd+D834ce7FdGLP4Iu2Vnv/bO0mD9X8+PMsFztKWVzwAAAAASUVORK5CYII=", 8, 6.5);

global.sprClinoW0 = sprite_add_base64("iVBORw0KGgoAAAANSUhEUgAAABUAAAAPCAMAAAA8hHRZAAAABlBMVEUAAAD///+l2Z/dAAAAAXRSTlMAQObYZgAAAC9JREFUeAGlyDEOACAQAkH8/6eNsZgc7W0Fk995RRDDyRBDDK2l1oZYFFMMMVT9C2PeAKZdKOF5AAAAAElFTkSuQmCC",1,9,7.5);
global.sprClinoW1 = sprite_add_base64("iVBORw0KGgoAAAANSUhEUgAAABkAAAAPCAMAAAAmuJTXAAAAGFBMVEUAAAAcIiYuNz4/GRNMVl2+/QgAAAD///+qNG/NAAAABnRSTlMAAAAAAABupgeRAAAASElEQVR4Aa3QMQ6AMAxDUccBfP8bozBYRAEG1DdUav/QKPgvSAYe8HaqbLuD7CgSAN87wW9Lyss/mrP1grg6M9Nl7kAOgwq+nFYsBKxdIVJ6AAAAAElFTkSuQmCC",1,9,7.5);
global.sprClinoW2 = sprite_add_base64("iVBORw0KGgoAAAANSUhEUgAAABMAAAANCAMAAAB8UqUVAAAAFVBMVEUAAAAAAAAcIiYuNz4/GRNMVl1fLyY/earuAAAAAXRSTlMAQObYZgAAAEBJREFUeAGNjzEOgDAQw+qk9P9PRscA8oaXulGkU9YDwxKkbRRShqJI76e2yH73ZBBA97iyz9m8TaDdA97hhf7dUCMAuYJjKKsAAAAASUVORK5CYII=",1,8,6.5);
global.sprClinoW3 = sprite_add_base64("iVBORw0KGgoAAAANSUhEUgAAABcAAAANCAMAAAB1uQVvAAAAM1BMVEUAAAAcIiYuNz44pBI/GRNMVl1fLyaKlp6+/QguNz4yOT44pBJMVl1seoSKlp6+/Qj///8aZwK4AAAACXRSTlMAAAAAAAAAAABzZJuhAAAAZElEQVR42oVPAQ7AEBCbGzanx/9/O4fLFku2Ni7VlrB9whGRe9tk0xBOM5bguLdToUrFuLwtEaTJUgo0aDolUULZ+2J9iKQBiJ4dvsIUZ2Te9sc7gvMxegbA1uspeUXvr//9xwUO/gO0cFF/PwAAAABJRU5ErkJggg==",1,8,6.5);

global.sprClinoSh = sprite_add_base64("iVBORw0KGgoAAAANSUhEUgAAACIAAAAICAMAAACrrt2gAAAACVBMVEUAAAAAAAD///+D3c/SAAAAAXRSTlMAQObYZgAAACNJREFUeAFjgAFGDMCABBjxALgC/IoYCQKgEsqNIcq5hD0NAHuYAOF6LcVTAAAAAElFTkSuQmCC",1,17,4);

global.sprClinoC0 = sprite_add_base64("iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAAACVBMVEUAAAAAAAD///+D3c/SAAAAAXRSTlMAQObYZgAAAEJJREFUeAFjoCFgBAOsEjAaQwaTieAiDGREk0EYiCKHySNCihHTLkZkKSiX9lKYziDTX4QDCt0uwpFCOCoRBtIOAACcTgBxCB2RIwAAAABJRU5ErkJggg==",1,13,13);
global.sprClinoC1 = sprite_add_base64("iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAAACVBMVEUAAAAAAAD///+D3c/SAAAAAXRSTlMAQObYZgAAACdJREFUeAFjGCjAyIhTBogGqxQjBCAYCBlM/YSlMA0cUqGBiMoBAgBVAgA9Ennd6QAAAABJRU5ErkJggg==",1,13,13);
global.sprClinoC2 = sprite_add_base64("iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAAAD1BMVEUAAAAAAABmZmaurq7////fntYNAAAAAXRSTlMAQObYZgAAADxJREFUeAFjQAaMjAw4ACMzMyMZUkxMJEkhnDEYASMQYBMDBwHCOwgPAgMGjxQuAwet7xkoi2XKUxSmMwCyPgCBihBl1wAAAABJRU5ErkJggg==",1,13,13);
global.sprClinoC3 = sprite_add_base64("iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAAADFBMVEUAAABmZmaurq7///+leQYWAAAAAXRSTlMAQObYZgAAACZJREFUeAFjGISAkZEcKSYm8qQodQZCjImJiREIoAw8UsPEywMPAHXqAFW1YAtEAAAAAElFTkSuQmCC",1,13,13);
global.sprClinoC4 = sprite_add_base64("iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAMAAACelLz8AAAACVBMVEUAAACurq7////CaPCNAAAAAXRSTlMAQObYZgAAAEZJREFUeNrFkUEKAEAIAlf//+i6hGAsHvNkjITUuxHYwg8MNAIZI/KEE2MxKL+T5JTEzIbYyigsTDV2eR9ykMjnzU/RK09U+YoAtfS/Tz0AAAAASUVORK5CYII=",1,13,13);

global.Clinodrawer = noone;

#define weapon_name
return "Clinometer";

#define weapon_sprt
return global.sprClino;

#define weapon_type
return 4;

#define weapon_auto
return false;

#define weapon_load
return 0;

#define weapon_cost
return 0;

#define weapon_swap
return sndSwapExplosive;

#define weapon_area
return 10;

#define weapon_text
return "THE WEAPON THAT CONQUERED THE CONTINENT";

#define step

if (argument0) {
	wkick = 10000;
	if ("clinoSqueak" not in self) {
		clinoSqueak = 0;
		clinoAngle = 0;
		clinoAngleG = 0;
		clinoAngleM = 0;
		clinoReloadM = 0;
		clinoCAngle1 = random(360);
		clinoCAngle2 = random(360);
		clinoCharge = 10;
		clinoFade = 0;
		clinoFired = false;
		clinoClicked = false;
	}
	
	if (right) {
		if (gunangle < 90) {clinoAngleG = gunangle/2}
		else {clinoAngleG = ((360 - gunangle)*-1)/2}
	}
	else {clinoAngleG = (gunangle - 180)/2}
	
	clinoX = x + lengthdir_x(clinoCharge, gunangle);
	clinoY = y + lengthdir_y(clinoCharge, gunangle);
	
	if ((!clinoFired) && (reload <= 0) && (ammo[4] >= 2)) {
		if (!clinoClicked) {
			clinoAngle = 0;
			sound_play_pitchvol(sndGrenadeHitWall, 0.8, 0.8);
			clinoClicked = true;
		}
	
		if (button_check(index,"fire")) {
			clinoCAngle1 += 2;
			clinoCAngle2 -= 4.44
			if (clinoCharge < 150) {
				clinoSqueak -= 1;
				if (clinoSqueak <= 0) {
					clinoSqueak = 6;
					sound_play_pitchvol(sndTurretSpawn, 1.15 + random(0.1), 0.5);
				}
				if (clinoFade < 1) {clinoFade += 0.1;}
				clinoCharge += 4;
				clinoAngle += 3;
			}
			else if (clinoCharge < 165) {
				clinoSqueak -= 1;
				if (clinoSqueak <= 0) {
					clinoSqueak = 5;
					sound_play_pitchvol(sndTurretSpawn, 1.3 + random(0.05), 0.75);
				}
				if (clinoFade > 0) {clinoFade -= 0.2;}
				clinoCharge += 3;
				clinoAngle += 2;
			}
			else {
				reload = 15 - (5*((maxhealth-my_health)/maxhealth)*skill_get(22));
				clinoCharge = 30;
				clinoFired = true;
				clinoClicked = false;
				clinoAngleM = clinoAngle;
				clinoReloadM = 15;
				clinoSqueak = 0;
			}
		}
		
		if button_released(index,"fire") {
			sound_play_pitchvol(sndGrenade, 0.8, 1.2);
		
			ammo[4] -= 2;
		
			repeat(7) with instance_create(x+lengthdir_x(15,gunangle)+lengthdir_x(10,gunangle+clinoAngle*right),y+lengthdir_y(6,gunangle)+lengthdir_y(15,gunangle+clinoAngle*right)+2,Smoke) {
				speed = random_range(2,4);
				direction = other.gunangle+other.clinoAngle*other.right + random_range(-16,16);
			}
		
			motion_add(gunangle, -4*120/clinoCharge)
		
			with instance_create(x+lengthdir_x(clinoCharge/2,gunangle),y+lengthdir_y(clinoCharge/2,gunangle),CustomObject) {
				Clinobomb = true;
				clinoX = other.clinoX;
				clinoY = other.clinoY;
				GrHeight = 200;
				creator = other;
				TTE = 15;
				sprite_index = global.sprClinoSh;
				image_alpha = 0.25;
				image_xscale = 0.1;
				image_yscale = 0.1;
				script_bind_step(clinobomb, 0, self);
				script_bind_draw(draw_clinobomb, -6.1);
			}
		
			clinoFade = 0;
			reload = 30 - (10*((maxhealth-my_health)/maxhealth)*skill_get(22));
			clinoCharge = 30;
			clinoFired = true;
			clinoClicked = false;
			clinoAngleM = clinoAngle;
			clinoReloadM = 30;
			clinoSqueak = 0;
		}
	}
	else {
		if (!button_check(index,"fire") || !clinoFired) {
			clinoFired = false;
			if (clinoAngle > 0) {clinoAngle -= ((clinoReloadM - reload)*7/clinoReloadM)*(clinoAngleM/100);}
		}
		else {reload += 1;}
	}
	
	if !instance_exists(global.Clinodrawer) {
		global.Clinodrawer = instance_create(0, 0, CustomObject);
		with(global.Clinodrawer){
			script_bind_draw(draw_clinoT, -6.1);
			script_bind_draw(draw_clinoW, depth+0.1);
		}
	}
}

#define clinobomb(Me)
with (Me) {
	image_xscale += 0.025;
	image_yscale += 0.025;
	image_alpha += 0.025;
	
	GrHeight -= 12;
	
	x += (clinoX - x)/7;
	y += (clinoY - y)/7;
	
	TTE -= 1;
	if (TTE <= 0) {
		sound_play_pitchvol(sndExplosionL, 0.9, 1.1);
		with instance_create(x,y,GreenExplosion) {
			creator = other.creator;
			damage *= 1.5;
		}
		instance_destroy();
	}
}
if (!instance_exists(Me)) {
	instance_destroy();
}

#define draw_clinobomb
with instances_matching(CustomObject, "Clinobomb", true) {
	draw_sprite_ext(sprHeavyNade, 0 ,x, y - GrHeight, 1, 1, GrHeight, c_white, 1);
}

#define draw_clinoW
with instances_matching(Player, "wep", "clinometer") {
	draw_sprite_ext(global.sprClinoW0,0,x+lengthdir_x(10,gunangle),y+lengthdir_y(6,gunangle)+2,right,1,clinoAngleG,player_get_color(index),image_alpha);
	draw_sprite_ext(global.sprClinoW1,0,x+lengthdir_x(10,gunangle),y+lengthdir_y(6,gunangle)+2,right,1,clinoAngle*right+clinoAngleG,player_get_color(index),image_alpha);
	draw_sprite_ext(global.sprClinoW2,0,x+lengthdir_x(10,gunangle),y+lengthdir_y(6,gunangle)+2,right,1,clinoAngleG,c_white,image_alpha);
	draw_sprite_ext(global.sprClinoW3,0,x+lengthdir_x(10,gunangle),y+lengthdir_y(6,gunangle)+2,right,1,clinoAngle*right+clinoAngleG,c_white,image_alpha);
}

#define draw_clinoT
with instances_matching(Player, "wep", "clinometer") {
	draw_sprite_ext(global.sprClinoC0, 0, clinoX, clinoY, 1, 1, 0, c_black, clinoFade);
	draw_sprite_ext(global.sprClinoC1, 0, clinoX, clinoY, 1, 1, clinoCAngle2, c_black, clinoFade);
	draw_sprite_ext(global.sprClinoC2, 0, clinoX, clinoY, 1, 1, clinoCAngle1, player_get_color(index), clinoFade);
	draw_sprite_ext(global.sprClinoC3, 0, clinoX, clinoY, 1, 1, clinoCAngle2, player_get_color(index), clinoFade);
	draw_sprite_ext(global.sprClinoC4, 0, clinoX, clinoY, 1, 1, 0, player_get_color(index), clinoFade);
}